{% extends 'base.html' %}

{% block title %}{% if object %}Edit Assignment{% else %}Create Assignment{% endif %} - Healthcare System{% endblock %}

{% block content %}
<div class="mb-8">
    <h1 class="text-4xl font-bold text-gray-800 mb-2">
        {% if object %}Edit Assignment{% else %}Create New Assignment{% endif %}
    </h1>
    <p class="text-gray-600">{% if object %}Update the assignment details{% else %}Assign a doctor to a patient{% endif %}</p>
</div>

<div class="max-w-2xl">
    <div class="bg-white rounded-lg shadow-md p-8">
        <form method="POST" class="space-y-6" novalidate>
            {% csrf_token %}

            <!-- Patient Selection -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-user text-purple-600 mr-2"></i>Select Patient *
                </label>
                <select name="patient" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600">
                    <option value="">-- Select a patient --</option>
                    {% for patient in patients %}
                        <option value="{{ patient.id }}" {% if object.patient_id == patient.id %}selected{% endif %}>
                            {{ patient.full_name }} ({{ patient.phone }})
                        </option>
                    {% endfor %}
                </select>
                {% if form.patient.errors %}<p class="text-red-600 text-sm mt-1">{{ form.patient.errors.0 }}</p>{% endif %}
            </div>

            <!-- Doctor Selection -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-stethoscope text-purple-600 mr-2"></i>Select Doctor *
                </label>
                <select name="doctor" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600">
                    <option value="">-- Select a doctor --</option>
                    {% for doctor in doctors %}
                        <option value="{{ doctor.id }}" {% if object.doctor_id == doctor.id %}selected{% endif %}>
                            Dr. {{ doctor.full_name }} - {{ doctor.get_specialization_display }} ({{ doctor.phone }})
                        </option>
                    {% endfor %}
                </select>
                {% if form.doctor.errors %}<p class="text-red-600 text-sm mt-1">{{ form.doctor.errors.0 }}</p>{% endif %}
            </div>

            <!-- Reason for Assignment -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-pen-fancy text-purple-600 mr-2"></i>Reason for Assignment *
                </label>
                <textarea name="reason" rows="4" placeholder="Describe the reason for this assignment..." 
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600">{{ object.reason }}</textarea>
                {% if form.reason.errors %}<p class="text-red-600 text-sm mt-1">{{ form.reason.errors.0 }}</p>{% endif %}
            </div>

            <!-- Notes -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    <i class="fas fa-sticky-note text-purple-600 mr-2"></i>Additional Notes
                </label>
                <textarea name="notes" rows="3" placeholder="Any additional notes or special instructions..." 
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600">{{ object.notes }}</textarea>
            </div>

            <!-- Status (Only for edit) -->
            {% if object %}
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-tasks text-purple-600 mr-2"></i>Status *
                    </label>
                    <select name="status" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600">
                        <option value="ACTIVE" {% if object.status == 'ACTIVE' %}selected{% endif %}>Active</option>
                        <option value="INACTIVE" {% if object.status == 'INACTIVE' %}selected{% endif %}>Inactive</option>
                        <option value="COMPLETED" {% if object.status == 'COMPLETED' %}selected{% endif %}>Completed</option>
                    </select>
                </div>
            {% endif %}

            <!-- Form Errors -->
            {% if form.non_field_errors %}
                <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg">
                    {% for error in form.non_field_errors %}
                        <p><i class="fas fa-exclamation-circle mr-2"></i>{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}

            <!-- Info Box -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <p class="text-blue-800 text-sm">
                    <i class="fas fa-info-circle mr-2"></i>
                    This assignment links a patient with a doctor for medical consultation and treatment.
                </p>
            </div>

            <!-- Buttons -->
            <div class="flex gap-4">
                <button type="submit" class="bg-purple-600 text-white px-8 py-3 rounded-lg font-medium hover:bg-purple-700 transition">
                    <i class="fas fa-save mr-2"></i>{% if object %}Update Assignment{% else %}Create Assignment{% endif %}
                </button>
                <a href="{% url 'mapping-list' %}" class="bg-gray-300 text-gray-700 px-8 py-3 rounded-lg font-medium hover:bg-gray-400 transition">
                    <i class="fas fa-times mr-2"></i>Cancel
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
